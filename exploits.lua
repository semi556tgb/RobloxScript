local Exploits = {}

local function StartCFrameSpeedLoop()
    local player = game:GetService("Players").LocalPlayer
    local runService = game:GetService("RunService")
    local input = game:GetService("UserInputService")

    while getgenv().CFrameSpeedEnabled do
        if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local hrp = player.Character.HumanoidRootPart
            local humanoid = player.Character:FindFirstChildOfClass("Humanoid")
            local moveDirection = Vector3.zero

            if input:IsKeyDown(Enum.KeyCode.W) then
                moveDirection = moveDirection + (workspace.CurrentCamera.CFrame.LookVector * Vector3.new(1, 0, 1))
            end
            if input:IsKeyDown(Enum.KeyCode.S) then
                moveDirection = moveDirection - (workspace.CurrentCamera.CFrame.LookVector * Vector3.new(1, 0, 1))
            end
            if input:IsKeyDown(Enum.KeyCode.A) then
                moveDirection = moveDirection - (workspace.CurrentCamera.CFrame.RightVector * Vector3.new(1, 0, 1))
            end
            if input:IsKeyDown(Enum.KeyCode.D) then
                moveDirection = moveDirection + (workspace.CurrentCamera.CFrame.RightVector * Vector3.new(1, 0, 1))
            end

            if moveDirection.Magnitude > 0 then
                local speed = math.clamp(getgenv().CFrameSpeedValue or 5, 0, 500)
                local delta = runService.Heartbeat:Wait()
                moveDirection = moveDirection.Unit * speed * delta

                -- Keep Y axis stable to avoid bouncing / camera shift
                hrp.CFrame = hrp.CFrame + Vector3.new(moveDirection.X, 0, moveDirection.Z)
            else
                runService.Heartbeat:Wait()
            end
        else
            runService.Heartbeat:Wait()
        end
    end
end

function Exploits.Setup(tab)
    local ExploitSection = tab:AddSection("Movement Exploits", 1)

    ExploitSection:AddToggle({
        text = "Infinite Jump",
        state = false,
        flag = "InfiniteJumpEnabled",
        callback = function(state)
            if state then
                getgenv().InfiniteJump = true
                if not getgenv().InfiniteJumpConnection then
                    getgenv().InfiniteJumpConnection = game:GetService("UserInputService").JumpRequest:Connect(function()
                        local humanoid = game:GetService("Players").LocalPlayer.Character and game:GetService("Players").LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
                        if humanoid and getgenv().InfiniteJump then
                            humanoid:ChangeState("Jumping")
                        end
                    end)
                end
            else
                getgenv().InfiniteJump = false
                if getgenv().InfiniteJumpConnection then
                    getgenv().InfiniteJumpConnection:Disconnect()
                    getgenv().InfiniteJumpConnection = nil
                end
            end
        end
    })

    ExploitSection:AddSlider({
        text = "CFrame Speed",
        min = 1,
        max = 500,
        value = 5,
        flag = "CFrameSpeed",
        callback = function(value)
            getgenv().CFrameSpeedValue = value
        end
    })

    ExploitSection:AddToggle({
        text = "Enable CFrame Speed",
        state = false,
        flag = "CFrameSpeedEnabled",
        callback = function(state)
            getgenv().CFrameSpeedEnabled = state
            if state then
                spawn(StartCFrameSpeedLoop)
            end
        end
    })
end

return Exploits
